import { BannerDemo } from '../../components/BannerDemo';

# Banner Experience Demo

See the Experience SDK decision engine in action with a live banner experience.

## Interactive Demo

This demo showcases a **Welcome Banner** with session-based frequency capping (3 impressions max).

The banner automatically appears at the **top of the page** on your first visit. To test the frequency cap:
1. Navigate to another page (e.g., [Home](/) or [Getting Started](/getting-started))
2. Return to this demo page
3. Each page load counts as an impression
4. After 3 visits, the banner will no longer appear

Watch the **Reasons** section below to see the explainability in action!

<BannerDemo />

## What Makes This Different?

Unlike traditional experience platforms, Experience SDK provides **complete explainability**:

### 1. Human-Readable Reasons
Every decision includes plain English explanations:
- âœ… "URL matches targeting rule"
- âœ… "Frequency cap not reached (2/3 this session)"
- âŒ "Frequency cap reached (3/3 this session)"

### 2. Machine-Readable Trace
Step-by-step execution trace with timing:
- Which rules were evaluated
- What the input/output was
- How long each step took (milliseconds)
- Whether it passed or failed

### 3. Full Context
Complete snapshot of the evaluation context:
- URL being evaluated
- Timestamp
- Custom data (user properties, segments, etc.)

## How Frequency Capping Works

The demo uses **session-based** frequency capping:

1. **First page load** (0/3 â†’ 1/3)
   - Banner shows at the top of the page
   - Impression recorded to `sessionStorage`
   - Reasons: "Frequency cap not reached (1/3 this session)"

2. **Subsequent page loads** (1/3 â†’ 2/3 â†’ 3/3)
   - Navigate away and return to increment the counter
   - Banner continues to show until cap reached

3. **After cap reached** (3/3)
   - Banner no longer appears
   - Reasons: "Frequency cap reached (3/3 this session)"

4. **Reset button**
   - Clears `sessionStorage` for testing purposes
   - Starts counter over at 0/3

**Note**: Session caps reset when you close the browser tab. For persistent caps (daily/weekly), use `localStorage` with `per: 'day'` or `per: 'week'`.

## Configuration for This Demo

```typescript
experiences.register('welcome-banner', {
  type: 'banner',
  targeting: {
    url: { contains: '/' }  // Show on all pages
  },
  content: {
    title: 'ğŸ‘‹ Welcome to Experience SDK',
    message: 'See how explainable client-side experiences work in real-time',
    button: {
      text: 'View Docs',
      url: '/getting-started'
    }
  },
  frequency: {
    max: 3,
    per: 'session'
  }
});
```

## Tracking Banner Actions

The banner plugin automatically emits events that you can listen to for tracking and analytics:

### Basic Event Tracking

```typescript
// Track when banner is shown
experiences.on('experiences:evaluated', ({ decision, experience }) => {
  if (decision.show && experience?.type === 'banner') {
    console.log(`Banner "${experience.id}" shown`);
    console.log('Reasons:', decision.reasons);
  }
});

// Track button clicks
experiences.on('experiences:action', ({ experienceId, action, url }) => {
  console.log(`User clicked "${action}" on "${experienceId}"`);
  console.log('Navigating to:', url);
});

// Track dismissals
experiences.on('experiences:dismissed', ({ experienceId }) => {
  console.log(`User dismissed "${experienceId}"`);
});
```

### Integrating with jstag3

Send experience events to Lytics via jstag3:

```typescript
// Track impressions
experiences.on('experiences:evaluated', ({ decision, experience }) => {
  if (decision.show && experience) {
    window.jstag.send('experience_shown', {
      experience_id: experience.id,
      experience_type: experience.type,
      reasons: decision.reasons.join(', ')
    });
  }
});

// Track button clicks
experiences.on('experiences:action', ({ experienceId, action, url }) => {
  window.jstag.send('experience_action', {
    experience_id: experienceId,
    action: action,
    destination_url: url
  });
});

// Track dismissals
experiences.on('experiences:dismissed', ({ experienceId }) => {
  window.jstag.send('experience_dismissed', {
    experience_id: experienceId
  });
});
```

### Multiple Analytics Platforms

The event-driven architecture allows multiple listeners:

```typescript
// Google Analytics
experiences.on('experiences:action', ({ experienceId, action }) => {
  gtag('event', 'banner_action', {
    experience_id: experienceId,
    action: action
  });
});

// Segment
experiences.on('experiences:action', ({ experienceId, action }) => {
  analytics.track('Banner Action', {
    experienceId,
    action
  });
});

// Custom API endpoint
experiences.on('experiences:action', async ({ experienceId, action }) => {
  await fetch('/api/track', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ experienceId, action })
  });
});
```

### Custom Actions

Configure custom action identifiers for specific behaviors:

```typescript
// Register banner with custom action
experiences.register('cookie-consent', {
  type: 'banner',
  targeting: { url: { contains: '/' } },
  content: {
    message: 'We use cookies to improve your experience',
    button: {
      text: 'Accept Cookies',
      action: 'accept-cookies' // Custom action identifier
    }
  },
  frequency: { max: 1, per: 'session' }
});

// Handle custom action
experiences.on('experiences:action', ({ action }) => {
  if (action === 'accept-cookies') {
    // Set cookie consent
    document.cookie = 'cookies_accepted=true; max-age=31536000';
    
    // Initialize analytics
    initializeAnalytics();
    
    // Track acceptance
    gtag('event', 'cookie_consent_accepted');
  }
});
```

## Why Event-Driven?

Unlike callback-based approaches (e.g., Pathfora), our event-driven architecture provides:

- **Multiple Consumers** - Many listeners can react to one event (jstag3, GA, Segment, custom code)
- **Decoupled** - Banner plugin doesn't know about tracking logic
- **Serializable Config** - No function references in config (JSON/CMS-friendly)
- **Testable** - Easy to mock and verify events
- **Composable** - Add/remove listeners dynamically

**Pathfora (Callbacks):**
```javascript
// âŒ Not serializable, single consumer, tightly coupled
{
  confirmAction: {
    callback: function(event, payload) {
      // MUST define all logic here
      analytics.track('Click', payload);
      jstag.send('click', payload);
      window.location = '/products';
    }
  }
}
```

**Our SDK (Events):**
```typescript
// âœ… Serializable, multiple consumers, decoupled
{
  button: {
    text: 'Shop Now',
    action: 'shop-cta',
    url: '/products'
  }
}

// Listener 1: Analytics
experiences.on('experiences:action', ({ action }) => {
  analytics.track('Click', { action });
});

// Listener 2: jstag3
experiences.on('experiences:action', ({ action }) => {
  jstag.send('click', { action });
});

// URL navigation happens automatically
```

---

See the [Events Reference](/reference/events) for comprehensive event documentation.

## More Banner Examples

Want to see different banner configurations? Here are common patterns:

### Cookie Banner (1x per day)
```typescript
{
  content: { 
    message: 'ğŸª This site uses cookies to improve your experience',
    button: {
      text: 'Accept',
      action: 'accept-cookies'
    }
  },
  frequency: { max: 1, per: 'day' },
  targeting: { url: { contains: '/' } }
}
```

### Announcement (5x per session)
```typescript
{
  content: {
    title: 'ğŸ‰ New Feature Release',
    message: 'Check out our latest updates',
    button: {
      text: 'Learn More',
      url: '/blog/new-features'
    }
  },
  frequency: { max: 5, per: 'session' },
  targeting: { url: { contains: '/dashboard' } }
}
```

### Flash Sale (2x per session, urgency)
```typescript
{
  content: {
    title: 'âš¡ï¸ Flash Sale',
    message: '50% off - Today only!',
    button: {
      text: 'Shop Now',
      url: '/products'
    }
  },
  frequency: { max: 2, per: 'session' },
  targeting: { url: { contains: '/products' } }
}
```

## Use Cases

This explainability is perfect for:
- ğŸ› **Debugging** - "Why didn't my banner show?"
- ğŸ“Š **A/B Testing** - Understand decision logic
- ğŸ” **Compliance** - Audit trail for data/privacy banners
- ğŸ‘¥ **Support** - Help users understand experience behavior
- ğŸ§ª **Testing** - Validate targeting rules before production

## Next Steps

- [Getting Started](/getting-started) - Install and setup
- [API Reference](/api) - Complete API documentation
- [Demo Overview](/demo) - Learn more about the demo


