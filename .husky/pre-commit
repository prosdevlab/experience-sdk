#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Build packages first (needed for typecheck due to workspace dependencies)
echo "ğŸ”¨ Building packages..."
pnpm build > /dev/null 2>&1

# Get staged files
files=$(git diff --cached --name-only --diff-filter=ACMR "*.ts" "*.tsx" "*.js" "*.jsx" | xargs)

if [ -n "$files" ]; then
  echo "ğŸ“ Linting and formatting staged files..."
  pnpm lint-staged $files
  git add $files
fi

# Type check entire project
echo "ğŸ” Type checking..."
pnpm typecheck

# Clean up dist files (they shouldn't be committed)
rm -rf packages/*/dist

echo "âœ… Pre-commit checks passed!"
